rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // UŻYTKOWNICY (Bez zmian)
    match /users/{userId} {
      allow read, update: if request.auth.uid == userId;
      allow create: if request.auth.uid == userId;
    }

    // OKAZJE (Bez zmian)
    match /deals/{dealId} {
      allow read: if true;
      allow create, update: if request.auth != null;
    }

    // GŁOSY (Krytyczna poprawka: dodano 'read')
    // Użytkownik musi móc odczytać swój głos (sprawdzić czy głosował)
    // oraz zapisać (zagłosować).
    match /deals/{dealId}/votes/{userId} {
      allow read, write: if request.auth.uid == userId;
    }

    // PRODUKTY (Krytyczny dodatek: nowa reguła)
    // Zezwól WSZYSTKIM na czytanie produktów (dane publiczne).
    // Zapis będzie kontrolowany przez Panel Admina (później).
    match /products/{productId} {
      allow read: if true;
      // Domyślnie 'write' jest zablokowane, co jest poprawne.
    }
  }
}